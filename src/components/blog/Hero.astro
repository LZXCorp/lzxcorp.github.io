---
import Languages from "../blog/Languages.astro";
import { Icon } from "astro-icon/components";
import Tag from "../ui/Tag.astro";
import ReadMore from "../ui/ReadMore.astro";
import Capsule from "../ui/Capsule.astro";
import DatePub from "./DatePub.astro";
import { getCollection } from "astro:content";

const [staticData] = await getCollection("staticData");
const {
  techsTitle,
  github,
  githubText,
  profileAlt,
  profileImage,
  profileLink,
  profileTitle,
  profileName,
} = staticData.data;

const postModules = import.meta.glob("../../pages/blog/posts/*.md", {
  eager: true,
});
const allPosts = Object.values(postModules) as any[];
const latestPost = allPosts.reduce((latest, current) => {
  const latestDate = new Date(latest.frontmatter.pubDate).getTime();
  const currentDate = new Date(current.frontmatter.pubDate).getTime();
  return currentDate > latestDate ? current : latest;
});
const tags = [...new Set(latestPost.frontmatter.tags ?? [])];
const languages = [...new Set(latestPost.frontmatter.languages ?? [])];
const image = latestPost.frontmatter.image.url;
const imageAlt =
  latestPost.frontmatter.image.alt || latestPost.frontmatter.title;

// Accent colour used across all three info cards
const accent = "rgb(239 68 68)";
---

<section class="py-8 px-8 max-sm:px-4 max-sm:py-2">
  <div class="max-w-7xl mx-auto flex flex-col gap-4 max-sm:gap-3">
    <!-- ── Featured Post: Split Hero ── -->
    <div
      class="bg-conic/[from_var(--border-angle)] dark:from-mint-200/30 dark:via-mint-500 dark:to-mint-200/20 from-mint-300/30 via-mint-500 to-mint-300/20 from-20% to-80% animate-rotate-border rounded-2xl p-[.15rem]"
    >
      <div class="rounded-2xl overflow-hidden bg-white dark:bg-zinc-900">
        <div
          class="flex max-md:flex-col-reverse min-h-[420px] max-xl:min-h-[360px] max-md:min-h-0"
        >
          <!-- Content Panel -->
          <div
            class="w-7/12 max-md:w-full p-10 max-xl:p-8 max-sm:p-6 flex flex-col justify-between gap-6 relative overflow-hidden bg-gradient-to-br from-white via-riptide-50/40 to-mint-50 dark:from-zinc-900 dark:via-zinc-900 dark:to-mint-950/30"
          >
            <!-- ambient glow -->
            <div
              class="absolute -bottom-24 -left-24 w-72 h-72 bg-mint-500/8 dark:bg-mint-500/15 rounded-full blur-3xl pointer-events-none"
            >
            </div>
            <!-- subtle grid -->
            <div
              class="absolute inset-0 opacity-[0.015] dark:opacity-[0.03] pointer-events-none bg-[repeating-linear-gradient(0deg,transparent,transparent_24px,currentColor_24px,currentColor_25px),repeating-linear-gradient(90deg,transparent,transparent_24px,currentColor_24px,currentColor_25px)]"
            >
            </div>

            <!-- Badge + Date -->
            <div class="flex items-center gap-4 flex-wrap z-10">
              <div
                class="flex items-center gap-2 px-3 py-1.5 bg-mint-500 rounded-lg text-white text-xs font-bold uppercase tracking-widest shadow-lg shadow-mint-500/20"
              >
                <Icon name="crosshair" class="size-3" />
                <span>Latest</span>
              </div>
              <div class="flex items-center gap-2">
                <Icon name="terminal" class="size-3 text-mint-500/50" />
                <DatePub date={latestPost.frontmatter.pubDate} />
              </div>
            </div>

            <!-- Title + CTA -->
            <a href={latestPost.url} class="z-10 flex flex-col gap-5 group">
              <h2
                class="text-5xl max-xl:text-4xl max-lg:text-3xl max-sm:text-2xl font-extrabold text-blacktext dark:text-white leading-tight tracking-tight group-hover:text-mint-600 dark:group-hover:text-mint-400 transition-colors duration-300"
              >
                {latestPost.frontmatter.title}
              </h2>
              <ReadMore />
            </a>

            <!-- Capsules + Tags -->
            <div class="flex flex-col gap-3 z-10">
              <div class="flex gap-2 flex-wrap">
                {
                  languages.map((lang: unknown) => (
                    <Capsule lang={lang?.toString() || ""} />
                  ))
                }
              </div>
              <div class="flex gap-2 flex-wrap">
                {tags.map((tag: unknown) => <Tag tag={tag}>{tag}</Tag>)}
              </div>
            </div>
          </div>

          <!-- Image Panel -->
          <a
            href={latestPost.url}
            class="group w-5/12 max-md:w-full max-md:aspect-video relative overflow-hidden"
            aria-label={`Read article: ${latestPost.frontmatter.title}`}
          >
            <div
              style={{ backgroundImage: `url(${image})` }}
              class="h-full w-full bg-center bg-cover transition-transform duration-700 group-hover:scale-105"
              role="img"
              aria-label={imageAlt}
            >
            </div>
            <div
              class="absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700 bg-[repeating-linear-gradient(0deg,transparent,transparent_4px,rgba(239,68,68,0.02)_4px,rgba(239,68,68,0.02)_8px)]"
            >
            </div>
            <div
              class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent dark:from-zinc-900/20 dark:to-transparent pointer-events-none"
            >
            </div>
          </a>
        </div>
      </div>
    </div>

    <!-- ── Info Strip ── -->
    <div class="grid md:grid-cols-3 gap-4 max-sm:gap-3">
      <!-- Person card -->
      <a
        href={profileLink}
        target="_blank"
        rel="noopener noreferrer"
        aria-label={`Visit ${profileName} on LinkedIn`}
        class="group relative rounded-2xl border border-zinc-200/50 dark:border-white/10 bg-white/80 dark:bg-[var(--accent)]/5 backdrop-blur-sm p-5 max-sm:p-4 ring-1 ring-zinc-200/50 dark:ring-white/10 transition-all duration-300 hover:border-[var(--accent)]/50 hover:ring-[var(--accent)]/40 hover:shadow-[0_0_30px_-5px_var(--accent-blur)] dark:hover:bg-[var(--accent)]/10 flex items-center gap-4 overflow-hidden"
        style={`--accent: ${accent}; --accent-blur: color-mix(in srgb, ${accent} 50%, transparent); --accent-light: color-mix(in srgb, ${accent} 20%, transparent);`}
      >
        <!-- stationary gradient overlay -->
        <div
          class="absolute inset-0 rounded-2xl overflow-hidden pointer-events-none -z-10"
        >
          <span
            aria-hidden="true"
            class="pointer-events-none absolute inset-0 opacity-20"
          >
            <span
              class="absolute inset-0 bg-gradient-to-br from-[var(--accent-light)] via-transparent to-transparent"
            ></span>
            <span
              class="absolute inset-0 bg-gradient-to-tl from-[var(--accent-light)] via-transparent to-transparent opacity-40"
            ></span>
          </span>
          <!-- rotating glow blobs -->
          <span
            aria-hidden="true"
            class="pointer-events-none absolute inset-0 animate-[spin_20s_linear_infinite] group-hover:animate-[spin_10s_linear_infinite]"
          >
            <span
              class="absolute -top-20 left-1/2 -translate-x-1/2 size-40 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-15 blur-3xl group-hover:opacity-50 group-hover:size-56 transition-all duration-500"
            ></span>
            <span
              class="absolute top-1/2 -right-20 -translate-y-1/2 size-36 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-15 blur-3xl group-hover:opacity-50 group-hover:size-52 transition-all duration-500"
            ></span>
            <span
              class="absolute -bottom-20 left-1/2 -translate-x-1/2 size-44 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-12 blur-3xl group-hover:opacity-45 group-hover:size-60 transition-all duration-500"
            ></span>
          </span>
        </div>

        <!-- Profile avatar with LinkedIn badge -->
        <div
          class="relative z-10 shrink-0 group-hover:scale-105 transition-transform duration-300"
        >
          <div
            aria-label={profileAlt}
            class="size-14 max-sm:size-12 rounded-xl bg-center bg-cover border border-zinc-200 dark:border-white/10"
            style={`background-image: url(${profileImage})`}
          >
          </div>
          <!-- LinkedIn badge -->
          <div
            class="absolute -bottom-1.5 -right-1.5 size-5 max-sm:size-4 rounded-md bg-[#0A66C2] flex items-center justify-center shadow-md"
          >
            <Icon name="linkedin" class="size-3 max-sm:size-2.5 text-white" />
          </div>
        </div>
        <div class="relative z-10 flex flex-col gap-1 min-w-0">
          <span
            class="flex items-center gap-1.5 text-xs font-bold uppercase tracking-widest"
            style="color: var(--accent)"
          >
            <Icon name="shield-lock" class="size-3" />
            Profile
          </span>
          <span
            class="font-bold text-base max-sm:text-sm text-blacktext dark:text-white leading-tight truncate"
            >{profileName}</span
          >
          <span
            class="text-xs text-zinc-500 dark:text-zinc-400 group-hover:text-[#0A66C2] transition-colors duration-300 flex items-center gap-1 truncate"
          >
            <Icon name="linkedin" class="size-3 shrink-0" />
            View Profile
          </span>
        </div>
      </a>

      <!-- GitHub card -->
      <a
        href={github}
        target="_blank"
        class="group relative rounded-2xl border border-zinc-200/50 dark:border-white/10 bg-white/80 dark:bg-[var(--accent)]/5 backdrop-blur-sm p-5 max-sm:p-4 ring-1 ring-zinc-200/50 dark:ring-white/10 transition-all duration-300 hover:border-[var(--accent)]/50 hover:ring-[var(--accent)]/40 hover:shadow-[0_0_30px_-5px_var(--accent-blur)] dark:hover:bg-[var(--accent)]/10 flex items-center gap-4 overflow-hidden"
        style={`--accent: ${accent}; --accent-blur: color-mix(in srgb, ${accent} 50%, transparent); --accent-light: color-mix(in srgb, ${accent} 20%, transparent);`}
      >
        <div
          class="absolute inset-0 rounded-2xl overflow-hidden pointer-events-none -z-10"
        >
          <span
            aria-hidden="true"
            class="pointer-events-none absolute inset-0 opacity-20"
          >
            <span
              class="absolute inset-0 bg-gradient-to-br from-[var(--accent-light)] via-transparent to-transparent"
            ></span>
            <span
              class="absolute inset-0 bg-gradient-to-tl from-[var(--accent-light)] via-transparent to-transparent opacity-40"
            ></span>
          </span>
          <span
            aria-hidden="true"
            class="pointer-events-none absolute inset-0 animate-[spin_22s_linear_infinite_reverse] group-hover:animate-[spin_11s_linear_infinite_reverse]"
          >
            <span
              class="absolute -top-20 left-1/2 -translate-x-1/2 size-40 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-15 blur-3xl group-hover:opacity-50 group-hover:size-56 transition-all duration-500"
            ></span>
            <span
              class="absolute top-1/2 -right-20 -translate-y-1/2 size-36 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-15 blur-3xl group-hover:opacity-50 group-hover:size-52 transition-all duration-500"
            ></span>
            <span
              class="absolute -bottom-20 left-1/2 -translate-x-1/2 size-44 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-12 blur-3xl group-hover:opacity-45 group-hover:size-60 transition-all duration-500"
            ></span>
          </span>
        </div>

        <div
          class="relative z-10 shrink-0 size-12 max-sm:size-10 flex items-center justify-center rounded-xl bg-zinc-900 dark:bg-zinc-800 text-white group-hover:scale-105 transition-transform duration-300"
        >
          <Icon name="github" class="size-6 max-sm:size-5" />
        </div>
        <div class="relative z-10 flex flex-col gap-1 min-w-0">
          <span
            class="flex items-center gap-1.5 text-xs font-bold uppercase tracking-widest"
            style="color: var(--accent)"
          >
            <Icon name="terminal" class="size-3" />
            Source
          </span>
          <span
            class="font-bold text-base max-sm:text-sm text-blacktext dark:text-white leading-tight"
            >{githubText}</span
          >
          <span
            class="text-xs text-zinc-500 dark:text-zinc-400 group-hover:text-mint-500 dark:group-hover:text-mint-400 transition-colors"
            >View repositories</span
          >
        </div>
      </a>

      <!-- Tech Stack card -->
      <div
        class="group relative rounded-2xl border border-zinc-200/50 dark:border-white/10 bg-white/80 dark:bg-[var(--accent)]/5 backdrop-blur-sm p-5 max-sm:p-4 ring-1 ring-zinc-200/50 dark:ring-white/10 transition-all duration-300 hover:border-[var(--accent)]/50 hover:ring-[var(--accent)]/40 hover:shadow-[0_0_30px_-5px_var(--accent-blur)] dark:hover:bg-[var(--accent)]/10 flex flex-col gap-3 overflow-hidden"
        style={`--accent: ${accent}; --accent-blur: color-mix(in srgb, ${accent} 50%, transparent); --accent-light: color-mix(in srgb, ${accent} 20%, transparent);`}
      >
        <div
          class="absolute inset-0 rounded-2xl overflow-hidden pointer-events-none -z-10"
        >
          <span
            aria-hidden="true"
            class="pointer-events-none absolute inset-0 opacity-20"
          >
            <span
              class="absolute inset-0 bg-gradient-to-br from-[var(--accent-light)] via-transparent to-transparent"
            ></span>
            <span
              class="absolute inset-0 bg-gradient-to-tl from-[var(--accent-light)] via-transparent to-transparent opacity-40"
            ></span>
          </span>
          <span
            aria-hidden="true"
            class="pointer-events-none absolute inset-0 animate-[spin_18s_linear_infinite] group-hover:animate-[spin_9s_linear_infinite]"
          >
            <span
              class="absolute -top-20 left-1/2 -translate-x-1/2 size-40 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-15 blur-3xl group-hover:opacity-50 group-hover:size-56 transition-all duration-500"
            ></span>
            <span
              class="absolute top-1/2 -right-20 -translate-y-1/2 size-36 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-15 blur-3xl group-hover:opacity-50 group-hover:size-52 transition-all duration-500"
            ></span>
            <span
              class="absolute -bottom-20 left-1/2 -translate-x-1/2 size-44 rounded-full bg-[radial-gradient(circle_at_center,_var(--accent),_transparent_60%)] opacity-12 blur-3xl group-hover:opacity-45 group-hover:size-60 transition-all duration-500"
            ></span>
          </span>
        </div>

        <span
          class="relative z-10 flex items-center gap-1.5 text-xs font-bold uppercase tracking-widest"
          style="color: var(--accent)"
        >
          <Icon name="code" class="size-3" />
          {techsTitle}
        </span>
        <div class="relative z-10 overflow-y-auto max-h-16">
          <Languages />
        </div>
      </div>
    </div>
  </div>
</section>
